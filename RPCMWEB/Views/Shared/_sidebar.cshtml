@using RPCMWEB.Models
<!-- ========== App Menu ========== -->
<div class="app-menu navbar-menu">
    <!-- LOGO -->
    <div class="navbar-brand-box">
        <!-- Dark Logo-->
        <a href="@Url.Action("Index", "Dashboard")" class="logo logo-dark">
            <span class="logo-sm">
                <img src="~/assets/images/logo-sm.png" alt="" height="22">
            </span>
            <span class="logo-lg">
                <img src="~/assets/images/logo-dark.png" alt="" height="17">
            </span>
        </a>
        <!-- Light Logo-->
        <a href="@Url.Action("Index", "Dashboard")" class="logo logo-light">
            <span class="logo-sm">
                <img src="~/assets/images/logo-sm.png" alt="" height="22">
            </span>
            <span class="logo-lg">
                <img src="~/assets/images/logo-light.png" alt="" height="17">
            </span>
        </a>
        <button type="button" class="btn btn-sm p-0 fs-20 header-item float-end btn-vertical-sm-hover" id="vertical-hover">
            <i class="ri-record-circle-line"></i>
        </button>
    </div>

    <div id="scrollbar">
        <div class="container-fluid">
            <div id="two-column-menu"></div>

            <!-- Simplified RPCM Navigation -->
            <ul class="navbar-nav" id="navbar-nav">
                <!-- Menu Title -->
                <li class="menu-title"><span data-key="t-menu">Main Menu</span></li>

                <!-- Dashboard -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="@Url.Action("Index", "Dashboard")">
                        <i class="ri-dashboard-2-line"></i>
                        <span>Dashboard</span>
                    </a>
                </li>

                <!-- Internal Systems -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarSystems" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarSystems">
                        <i class="ri-apps-2-line"></i>
                        <span>Internal Systems</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarSystems">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="http://ithelpme.rpcm.com.my/" target="_blank" class="nav-link">IT HelpMe</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://ess.rpcm.com.my/" target="_blank" class="nav-link">ESS Portal</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://hr.rpcm.com.my/sites/plex" target="_blank" class="nav-link">Plex Portal</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://bp1acmap014.rpcm.local:8080/webtop/" target="_blank" class="nav-link">DOCUMENTUM</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://bp1acmap013/" target="_blank" class="nav-link">RTWeb</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Departments -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarDepartments" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarDepartments">
                        <i class="ri-building-line"></i>
                        <span>Departments</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarDepartments">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="http://maint.rpcm.com.my/IC/" target="_blank" class="nav-link">I&C</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://eptw.rpcm.com.my/" target="_blank" class="nav-link">EPTW</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://maint.rpcm.com.my/Electrical/" target="_blank" class="nav-link">Electrical</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://hsse.rpcm.com.my/Pages/Home.aspx" target="_blank" class="nav-link">Wasteport</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://opr.rpcm.com.my/" target="_blank" class="nav-link">Operation</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://tech.rpcm.com.my/" target="_blank" class="nav-link">Technical</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Archive -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarArchive" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarArchive">
                        <i class="ri-archive-drawer-line"></i>
                        <span>Archive</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarArchive">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="http://inside.rpcm.com.my/Pages/air.aspx" target="_blank" class="nav-link">Investigation Report</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://inside.rpcm.com.my/Pages/asr.aspx" target="_blank" class="nav-link">Staff Related</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://inside.rpcm.com.my/Pages/apn.aspx" target="_blank" class="nav-link">Plant Newsletter</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://inside.rpcm.com.my/Pages/ak.aspx" target="_blank" class="nav-link">KESUKA</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://inside.rpcm.com.my/Pages/alnd.aspx" target="_blank" class="nav-link">Learning & Development</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Corporate Links -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarCorporate" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarCorporate">
                        <i class="ri-links-line"></i>
                        <span>Corporate Links</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarCorporate">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="http://www.ril.com/" target="_blank" class="nav-link">Reliance</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://myportal.ril.com/irj/portal" target="_blank" class="nav-link">MyPortal</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://10.128.28.42/rpcm/html/index.html" target="_blank" class="nav-link">RPCM</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://www.recronmalaysia.com/" target="_blank" class="nav-link">Recron Malaysia</a>
                            </li>
                            <li class="nav-item">
                                <a href="https://mail.ril.com/" target="_blank" class="nav-link">RIL Outlook</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://ircmsoverseas.ril.com/" target="_blank" class="nav-link">iRCMS</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Tools & Utilities -->
                <li class="menu-title"><i class="ri-more-fill"></i> <span>Tools & Utilities</span></li>

                <!-- Reports -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarReports" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarReports">
                        <i class="ri-file-chart-line"></i>
                        <span>Reports</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarReports">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="http://bp1acmap011.rpcm.local/webmatrix/webclient/loginpage.aspx" target="_blank" class="nav-link">WebMatrix Access Report</a>
                            </li>
                            <li class="nav-item">
                                <a href="http://ktnapa02/sites/cms" target="_blank" class="nav-link">iCON</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Settings -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarSettings" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarSettings">
                        <i class="ri-settings-3-line"></i>
                        <span>Settings</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarSettings">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Profile", "Account")" class="nav-link">User Profile</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Settings", "Account")" class="nav-link">Account Settings</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Notifications", "Account")" class="nav-link">Notifications</a>
                            </li>
                        </ul>
                    </div>
                </li>

                <!-- Help & Support -->
                <li class="nav-item">
                    <a class="nav-link menu-link" href="#sidebarSupport" data-bs-toggle="collapse" role="button"
                       aria-expanded="false" aria-controls="sidebarSupport">
                        <i class="ri-customer-service-2-line"></i>
                        <span>Help & Support</span>
                    </a>
                    <div class="collapse menu-dropdown" id="sidebarSupport">
                        <ul class="nav nav-sm flex-column">
                            <li class="nav-item">
                                <a href="@Url.Action("Help", "Home")" class="nav-link">Help Center</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("Contact", "Home")" class="nav-link">Contact Support</a>
                            </li>
                            <li class="nav-item">
                                <a href="@Url.Action("About", "Home")" class="nav-link">About RPCM</a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="sidebar-background"></div>
</div>
<!-- Left Sidebar End -->
<!-- Vertical Overlay-->
<div class="vertical-overlay"></div>

<!-- JavaScript for Sidebar Functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Initializing RPCM sidebar...');

        // Initialize Bootstrap collapse functionality
        const collapseElements = document.querySelectorAll('[data-bs-toggle="collapse"]');

        collapseElements.forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();

                const target = document.querySelector(this.getAttribute('href'));
                if (!target) return;

                // Close other open dropdowns in the same level
                const parentMenu = this.closest('.menu-dropdown') || this.closest('.navbar-nav');
                if (parentMenu) {
                    parentMenu.querySelectorAll('.menu-dropdown.show').forEach(openDropdown => {
                        if (openDropdown !== target) {
                            openDropdown.classList.remove('show');
                        }
                    });
                }

                // Toggle current dropdown
                target.classList.toggle('show');

                // Update aria-expanded
                const isExpanded = target.classList.contains('show');
                this.setAttribute('aria-expanded', isExpanded);
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.navbar-nav')) {
                document.querySelectorAll('.menu-dropdown.show').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
                document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(toggle => {
                    toggle.setAttribute('aria-expanded', 'false');
                });
            }
        });

        // Handle sidebar hover functionality
        const verticalHoverBtn = document.getElementById('vertical-hover');
        if (verticalHoverBtn) {
            verticalHoverBtn.addEventListener('click', function() {
                document.body.classList.toggle('vertical-sidebar-enable');
            });
        }

        // Set active menu item based on current page
        function setActiveMenuItem() {
            const currentPath = window.location.pathname.toLowerCase();
            const menuLinks = document.querySelectorAll('.nav-link');

            menuLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href && currentPath.includes(href.toLowerCase())) {
                    link.classList.add('active');
                    // Also activate parent dropdown if exists
                    const parentDropdown = link.closest('.menu-dropdown');
                    if (parentDropdown) {
                        parentDropdown.classList.add('show');
                        const parentToggle = document.querySelector(`[href="#${parentDropdown.id}"]`);
                        if (parentToggle) {
                            parentToggle.setAttribute('aria-expanded', 'true');
                        }
                    }
                }
            });
        }

        setActiveMenuItem();

        console.log('RPCM sidebar initialized successfully');
    });

    // Add custom CSS for better styling
    const style = document.createElement('style');
    style.textContent = `
        .app-menu {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 250px;
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .menu-dropdown {
            background: #f8f9fa;
            border-radius: 0 0 8px 8px;
        }

        .nav-link {
            transition: all 0.2s ease;
            border-radius: 6px;
            margin: 2px 8px;
            color: #495057;
        }

        .nav-link:hover {
            background: rgba(11, 107, 59, 0.1);
            color: #0b6b3b;
        }

        .nav-link.active {
            background: #0b6b3b;
            color: white;
        }

        .menu-dropdown .nav-link {
            padding-left: 1.5rem;
            font-size: 0.9rem;
        }

        .menu-title {
            padding: 1rem 1.5rem 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
        }

        /* External link indicator */
        .nav-link[target="_blank"]::after {
            content: "↗";
            margin-left: 4px;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Mobile responsiveness */
        @@media (max-width: 991.98px) {
            .app-menu {
                transform: translateX(-100%);
            }

            .app-menu.show {
                transform: translateX(0);
            }
        }

        /* Scrollbar styling */
        #scrollbar {
            height: calc(100vh - 70px);
            overflow-y: auto;
        }
    `;
    document.head.appendChild(style);
</script>